<!-- create campaign dialog -->
<ng-template #adddialog>
  <h1 mat-dialog-title class="txt">Create A Campaign</h1>
  <div mat-dialog-content>
    <mat-error *ngIf="error">{{errormessage}}</mat-error>
      <mat-form-field class="kb-full-width mb-2" appearance="fill">
        <mat-label>Campaign Name</mat-label>
        <input type="text" matInput name="campaignname" [(ngModel)]="campaignname" [formControl]="campaignnameControl" required minlength="3" >
        <mat-error *ngIf="campaignnameControl.hasError('minlength')">
            Name must be at least <strong>3</strong> characters
        </mat-error>
    </mat-form-field>
  </div>
  <div mat-dialog-actions class="justify-content-end">
      <button mat-button mat-dialog-close class="text-danger">Close</button>
      <button mat-button
      [color]="!campaignnameControl.invalid ? 'primary' : ''"  
      [disabled]="campaignnameControl.invalid"
      (click)="createcamp()">Create</button>
  </div>
</ng-template>
<!-- close create campaign dialog -->
<!-- delete campaign dialog -->
<ng-template #deletedialog>
  <h1 mat-dialog-title class="kb-danger">Delete Campaign</h1>
  <div mat-dialog-content>
    Would you like to delete <span class="text-danger">{{delcampaign.name}}</span> campaign?
  </div>
  <div mat-dialog-actions class="justify-content-end">
    <button mat-button mat-dialog-close [color]="'primary'">No</button>
    <button
      mat-button
      mat-dialog-close
      cdkFocusInitial
      class="text-danger"
      (click)="deletecampaign(delcampaign)"
    >
      Yes
    </button>
  </div>
</ng-template>
<ng-template #delselecteddialog>
  <h1 mat-dialog-title class="kb-danger">Delete Selected Campaigns</h1>
  <div mat-dialog-content>
    Would you like to delete <span class="text-danger">{{selectedCampaigns.length}}</span> campaigns?
  </div>
  <div mat-dialog-actions class="justify-content-end">
    <button mat-button mat-dialog-close cdkFocusInitial [color]="'primary'" (click)="resetselecteddata()">No</button>
    <button mat-button mat-dialog-close (click)="deleteSelectedCampaigns(selectedCampaigns)" class="text-danger">Yes</button>
  </div>
</ng-template>
<!-- close delete campaign dialog -->
    <div class="container-fluid">
      <mat-progress-bar *ngIf="fetching" mode='indeterminate'></mat-progress-bar>
    <div  class="row">
        <mat-form-field  class="col-md-3 px-3"  appearance="fill" >
          <mat-label>Search Campaigns...</mat-label>
            <input matInput #searchInp (input)="searchCampaigns(searchInp, sortInp,sentInp,listInp)" type="text" placeholder="Search Campaigns">
            <i class="fa-solid fa-magnifying-glass"></i>
        </mat-form-field>
        <mat-form-field  class="col-md-2 px-2" appearance="fill">
          <mat-label>Filter by:</mat-label>
          <mat-select #sortInp name="kbfilter" value='created_at DESC' (valueChange)="searchCampaigns(searchInp, sortInp,sentInp,listInp)">
            <mat-option [value]="'name ASC'">ASC By Name</mat-option>
            <mat-option [value]="'name DESC'">DESC By Name</mat-option>
            <mat-option [value]="'created_at ASC'">ASC By Create</mat-option>
            <mat-option [value]="'created_at DESC'">DESC By Create</mat-option>
            <mat-option [value]="'updated_at ASC'">ASC By Update</mat-option>
            <mat-option [value]="'updated_at DESC'">DESC By Update</mat-option>
        </mat-select>
        </mat-form-field>
      <mat-form-field  class="col-md-2 px-2" appearance="fill">
        <mat-label>Filter by Status:</mat-label>
        <mat-select #sentInp name="kbfilter" value='' (valueChange)="searchCampaigns(searchInp, sortInp,sentInp, listInp)">
          <mat-option value="" selected>All</mat-option>
          <mat-option [value]="'0'" >Drafts</mat-option>
          <mat-option [value]="'1'">Sent</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field  class="col-md-2 px-2" appearance="fill">
        <mat-label>Filter By List</mat-label>
            <mat-select #listInp name="listfilter" value='' (valueChange)="searchCampaigns(searchInp, sortInp,sentInp,listInp)">
                <mat-option value="" selected>All</mat-option>
                <mat-option *ngFor="let list of lists" [value]="list.id">
                    {{list?.name | titlecase}}
                  </mat-option>
            </mat-select>
      </mat-form-field>
    <div class="col-md-3 text-right p-0">
      <span class="align-items-center px-2 pt-2"><mat-checkbox class="align-items-center" [(ngModel)]="checked_selected" (ngModelChange)="selectAllCampaigns($event)" matTooltip="Select All Page Campaigns" matTooltipPosition="above"></mat-checkbox></span>
      <button mat-raised-button [color]="'accent'" (click)="togglepageview()" class="mr-3">
        <span *ngIf="!toggleview else gridview">List View <i class="fas fa-th-list"></i></span>
        <ng-template #gridview><span>Grid View <i class="fas fa-th"></i></span></ng-template>
      </button>
      <button mat-raised-button color="primary" class="mr-2 d-inline-block" (click)="openDialog(adddialog,false)">
        <i class="fa fa fa-envelope" aria-hidden="true"></i> Create Campaign
      </button>
    </div>
    </div>
    <div class="row">
      <div class="col-md-12" *ngIf="selectedCampaigns.length > 0">
        <div class="float-right mb-3 kb-delbtn" (click)="openDialog(delselecteddialog, selectedCampaigns)">
          <span class="">Delete Selected Campaigns <i class="fa fa-trash-alt"></i></span>
        </div>
      </div>
    </div>
    <div [class.px-3]="toggleview" class="row" *ngIf="pagecampaigns?.length != 0; else nodata">
      <div [class]="toggleview ? 'col-md-12' : 'col-md-4'"  class="cardpage mt-4 " *ngFor="let kbcampaign of pagecampaigns; index as i;">
        <div [class.row]="toggleview">
          <div
          [style.height]="toggleview ? '150px' : '300px'"
          [class]="toggleview ? 'col-md-6' : 'col-md-12'"
          class="p-0"
        >
        <div [class.kb-disabled]="kbcampaign.deleting" class="kb-fitimg"
            [ngStyle]="{
              'background-image':
                'url(' +
                _image.uploadImgPath +
                _general.getSSPath('campaign-' + kbcampaign.uniqueid) +
                '), url(' +
                _image.uploadImgPath +
                'webpage_thumbnail.jpg' +
                ')'
            }"
              >
            </div>
            </div>
          <div [class]="toggleview ? 'col-md-6' : 'col-md-12 pt-3'">
            <div class="row align-items-center p-0 h-100">
              <div [class.p-0]="!toggleview" class="col-md-12">
                <div class="keabuilder-title-board line-ellipsis ftsize">
                  <span>{{kbcampaign.name | titlecase}}</span>  
                  <input type="text" [(ngModel)]="kbcampaign.name"
                    (blur)="changepagename(kbcampaign,kbcampaign.name)" matTooltip="Edit Campaign Name"
                    matTooltipPosition="above">
                </div>
                <div class="d-flex justify-content-between">
                  <button *ngIf="kbcampaign.campaign_sent=='1'" class="view-btn3 align" mat-raised-button>View Report<i class="fa-solid fa-chart-pie ml-1" aria-hidden="true"></i></button>
                  <button  *ngIf="kbcampaign.campaign_sent=='0'" mat-raised-button  [routerLink]="'/crm/campaign/'+kbcampaign.uniqueid" class="view-btn3 mr-2 "> Continue <i class="fa fa-arrow-alt-circle-right"></i></button> 
                  <button mat-raised-button  class=" view-btn1 ml-2" [matMenuTriggerFor]="menu2"> More <i class="fas fa-cog"></i></button>
                <mat-menu #menu2="matMenu">
                  <button mat-menu-item [routerLink]="'/crm/campaign/'+kbcampaign.uniqueid" *ngIf="(kbcampaign.sendoption =='recurring' || kbcampaign.campaignsent =='0')">
                    <i class="fa-regular fa-pen-to-square mr-2"></i>Edit
                  </button>
                  <button mat-menu-item  (click)="duplicatecampaign(kbcampaign)">
                    <i class="far fa-copy mr-2"></i>Duplicate
                  </button>
                 
                  <button class="text-danger" mat-menu-item (click)="openDialog(deletedialog,kbcampaign)">
                    <i class="far fa-trash-alt mr-2"></i>Delete
                  </button>
                </mat-menu>
                </div>

                <div class="sentoption">
                  <hr>
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="align-items-center fnt" matTooltip="click to select" matTooltipPosition="above"><mat-checkbox class="fnt align-items-center mr-2" [(ngModel)]="kbcampaign.selected" (ngModelChange)="selectCampaigns($event, kbcampaign)"></mat-checkbox>
                    <span class="fnt"><i class="fa fa-user mr-2 colr" aria-hidden="true"></i>Sent To: <span *ngIf="kbcampaign.sentto>0"> {{kbcampaign.sentto}}</span>
                    <span *ngIf="kbcampaign.sentto==0">--</span></span>
                  </span>
                  <span class="fnt">Sent On: 
                    <span *ngIf="kbcampaign.deliverdate"><i class="fa fa-calendar-alt" aria-hidden="true"></i> {{dateformat(kbcampaign.deliverdate)}}</span>
                    <span *ngIf="!kbcampaign.deliverdate">--</span>
                  </span>
                </div>
                <div class="d-flex justify-content-between mt-1 mb-1">
                    <span class="fnt">Created On: <span><i class="far fa-calendar-alt" aria-hidden="true"></i> {{dateformat(kbcampaign.created_at)}}</span></span>
                    <span class="fnt">Last Modified On: <span><i class="far fa-calendar-alt" aria-hidden="true"></i> {{dateformat(kbcampaign.updated_at)}}</span></span>
                  </div>
              </div>
              </div>
            </div>
          </div>
            <div class="d-flex justify-content-between">
          <div class="statbadg">
            <span class="statusbadge" [class]="kbcampaign.publish_status==1 ? 'active1':'active2'" *ngIf="kbcampaign.campaign_sent=='0'">
              <i class="fas" [class]="kbcampaign.publish_status==1 ? 'fa-check':'fa-file'"></i>
              {{kbcampaign.publish_status==1?'Schedule':'Draft'}}
            </span>

            <span class="statusbadge1" [class]="kbcampaign.publish_status==1 ? 'active1':'active2'" *ngIf="kbcampaign.campaign_sent=='1'">
              <i class="fas fa-paper-plane"></i> Sent
            </span>

          </div>
          <!-- <div  class="statbadg3"><mat-checkbox class="align-items-center" [(ngModel)]="kbcampaign.selected" (ngModelChange)="selectCampaigns($event, kbcampaign)"></mat-checkbox></div> -->
          <div class="statbadg2">
            <span class="statusbadge2">{{kbcampaign.sendoption=='immediately'?'Immediately':'Specific Time'}}</span>
          </div>
        </div>
        </div>
      </div>
    </div>
    <mat-paginator  #paginator [length]="campaignslength" [pageSize]="20" [pageSizeOptions]="[20, 50, 100, 200, 500]" aria-label="Select page" (page)="getpagecampaigns($event)"></mat-paginator>
    </div>
    <ng-template #nodata>
      <div class="row justify-content-center mt-5">
        <div class="col-md-4">
          <img
            src="/assets/images/website/website-empty.png"
            class="img-fluid"
            alt="No Campaign Found"
          />
        </div>
      </div>
    </ng-template>
  

