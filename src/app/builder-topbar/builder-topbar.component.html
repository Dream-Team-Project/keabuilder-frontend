<ng-template #deltempdialog>
    <h1 mat-dialog-title class="kb-danger">Delete Template</h1>
    <div mat-dialog-content>
        Would you like to delete <span class="kb-danger">{{seltemp.name}}</span> template?
    </div>
    <div mat-dialog-actions class="justify-content-end">
        <button mat-button mat-dialog-close class="kb-info">No</button>
        <button mat-button mat-dialog-close cdkFocusInitial class="kb-danger" (click)="deleteTemplate()">Yes</button>
    </div>
</ng-template>
<ng-template #renametempdialog>
    <h1 mat-dialog-title class="kb-info">Rename Template</h1>
    <div mat-dialog-content>
        <mat-form-field appearance="fill" class="w-100">
            <mat-label>Template name</mat-label>
            <input matInput type="text" placeholder="Template name" [(ngModel)]="seltemp.name">
          </mat-form-field>
    </div>
    <div mat-dialog-actions>
        <button mat-button mat-dialog-close class="kb-danger">Cancel</button>
        <button mat-button mat-dialog-close cdkFocusInitial class="kb-info" (click)="updateTemplate()">Rename</button>
    </div>
</ng-template>
<div #topBar id="kb-topBar">
    <div class="kb-triggers">
        <button mat-button disabled><img [src]="_image.imgPath+'logo/kblogo-white.png'"></button>
        <button mat-button (click)="backBtn(_general.userService.navPath[0])" class="kb-backBtn kb-padadj">
            <i [innerHTML]="_image.svg.left_circle_arrow | safeHtml"></i><p class="kb-bb-text">Back</p>
        </button>
        <button mat-button [disabled]="wftgl" #layt="matMenuTrigger" [matMenuTriggerFor]="layout" [class.kb-btn-active]="(layt.menuOpen || selectedTab.split('-')[0] == 'l') && !wftgl">
            <i [innerHTML]="_image.svg.layout | safeHtml"></i> Layouts {{selectedTab.split('-')[0] == 'l' ? ('> '+selectedTab.split('-')[1] | titlecase): ''}}
        </button>
        <mat-menu #layout="matMenu" xPosition="after" yPosition="below">
            <button mat-menu-item (click)="selectTab('l-templates')" [class.kb-btn-active]="selectedTab == 'l-templates'">
                <i [innerHTML]="_image.svg.template | safeHtml"></i> Templates
            </button>
            <button mat-menu-item (click)="selectTab('l-sections')" [class.kb-btn-active]="selectedTab == 'l-sections'">
                <i [innerHTML]="_image.svg.section | safeHtml"></i> Sections
            </button>
            <button mat-menu-item (click)="selectTab('l-rows')" [class.kb-btn-active]="selectedTab == 'l-rows'">
                <i [innerHTML]="_image.svg.row | safeHtml"></i> Rows
            </button>
            <button mat-menu-item (click)="selectTab('l-headers')" [class.kb-btn-active]="selectedTab == 'l-headers'">
                <i [innerHTML]="_image.svg.header | safeHtml"></i> Headers
            </button>
            <button mat-menu-item (click)="selectTab('l-footers')" [class.kb-btn-active]="selectedTab == 'l-footers'">
                <i [innerHTML]="_image.svg.footer | safeHtml"></i> Footers
            </button>
        </mat-menu>
        <button mat-button [disabled]="wftgl" (click)="selectTab('elements')" [class.kb-btn-active]="selectedTab == 'elements' && !wftgl">
            <i [innerHTML]="_image.svg.elements | safeHtml"></i> Elements
        </button>
        <button mat-button [disabled]="wftgl" (click)="selectTab('responsive')" [class.kb-btn-active]="selectedTab == 'responsive' && !wftgl">
            <i [innerHTML]="_image.svg.responsive | safeHtml"></i> Responsive
        </button>
        <button mat-button #moret="matMenuTrigger" [matMenuTriggerFor]="more" [class.kb-btn-active]="moret.menuOpen || _general.selectedBlock.type == 'main' || wftgl">
            <i [innerHTML]="_image.svg.ellipsisv | safeHtml"></i>
            More {{_general.selectedBlock.type == 'main' ? '> Setting' : (wftgl ? '> Wireframe' : '')}}
        </button>
        <mat-menu #more="matMenu" xPosition="after" yPosition="below">
            <button mat-menu-item (click)="_section.undo()">
                <i [innerHTML]="_image.svg.undo | safeHtml"></i> Undo
            </button>
            <button mat-menu-item (click)="_section.redo()">
                <i [innerHTML]="_image.svg.redo | safeHtml"></i> Redo
            </button>
            <button mat-menu-item (click)="wireframeToggle.emit(true)" [class.kb-btn-active]="wftgl">
                <i [innerHTML]="_image.svg.wireframe | safeHtml"></i> Wireframe
            </button>
            <button mat-menu-item (click)="setTrigger('setting')"
                [class.kb-btn-active]="_general.selectedBlock.type == 'main'">
                <i [innerHTML]="_image.svg.setting | safeHtml"></i> Setting
            </button>
        </mat-menu>
        <button mat-button (click)="_general.preview()">
            <i [innerHTML]="_image.svg.preview | safeHtml"></i> Preview
        </button>
        <button mat-button (click)="!_general.saveDisabled ? setTrigger('save') : ''" [disabled]="_general.saveDisabled">
            <i [innerHTML]="_image.svg.save | safeHtml"></i> Save
        </button>
        <button mat-button [disabled]="_general.saveDisabled" #statust="matMenuTrigger" [matMenuTriggerFor]="status" [class.kb-btn-active]="statust.menuOpen">
            <i [innerHTML]="(_general.main.publish_status ? _image.svg.publish : _image.svg.draft) | safeHtml"></i> Status > {{_general.main.publish_status ? 'Published' : 'Draft'}}
        </button>
        <mat-menu #status="matMenu" xPosition="after" yPosition="below">
            <button mat-menu-item (click)="setTrigger('publish')" [class.kb-btn-active]="_general.main.publish_status">
                <i [innerHTML]="_image.svg.publish | safeHtml"></i> Publish
            </button>
            <button mat-menu-item (click)="setTrigger('draft')" [class.kb-btn-active]="!_general.main.publish_status">
                <i [innerHTML]="_image.svg.draft | safeHtml"></i> Draft
            </button>
        </mat-menu>
        <button *ngIf="selectedTab && !wftgl" mat-button (click)="hideBar()">
            <mat-icon>keyboard_arrow_up</mat-icon>
        </button>    
    </div>
    <div class="kb-triggers">
        <button mat-button #rowt="matMenuTrigger" *ngIf="selectedTab == 'l-rows' && !wftgl" [class.kb-btn-active]="rowt.menuOpen" [matMenuTriggerFor]="rowmenu">
            <i [innerHTML]="_image.svg.filter | safeHtml"></i> Row Type > {{searchRowFilter.name}} Column{{searchRowFilter.value != 1 ? 's' : ''}}
        </button>
        <mat-menu #rowmenu="matMenu" xPosition="before" yPosition="below">
            <button mat-menu-item *ngFor="let type of rowtypes" (click)="selectFilter(type)" [class.kb-btn-active]="searchRowFilter.value == type.value" [value]="type.value">{{type.name}} Column{{type.value != 1 ? 's' : ''}}</button>
        </mat-menu>
        <button mat-button #imgt="matMenuTrigger" *ngIf="selectedTab == 'elements' && selectedElement == 'image' && !wftgl" [class.kb-btn-active]="imgt.menuOpen" [matMenuTriggerFor]="imgmenu">
            <i [innerHTML]="_image.svg.filter | safeHtml"></i> Sort By > <i class="kb-filter-icon" [innerHTML]="(_image.searchImgFilter.name.split(' ')[0] == 'Ascending' ? _image.svg.ascending : _image.svg.descending) | safeHtml"></i> {{_image.searchImgFilter.name.split(' ')[2]}}
        </button>
        <mat-menu #imgmenu="matMenu" xPosition="before" yPosition="below">
            <button mat-menu-item *ngFor="let order of _image.imgOrder" (click)="_image.searchImgFilter = order" [class.kb-btn-active]="_image.searchImgFilter.name == order.name" [value]="order.value">{{order.name}}</button>
        </mat-menu>
        <button mat-button #tempt="matMenuTrigger" *ngIf="selectedTab == 'l-templates' && !wftgl" [class.kb-btn-active]="tempt.menuOpen" [matMenuTriggerFor]="tempmenu">
            <i [innerHTML]="_image.svg.filter | safeHtml"></i> Sort By > <i class="kb-filter-icon" [innerHTML]="(tempOrderFilter.name.split(' ')[0] == 'Ascending' ? _image.svg.ascending : _image.svg.descending) | safeHtml"></i> {{tempOrderFilter.name.split(' ')[2]}}
        </button>
        <mat-menu #tempmenu="matMenu" xPosition="before" yPosition="below">
            <button mat-menu-item *ngFor="let order of tempOrder" (click)="tempOrderFilter = order" [class.kb-btn-active]="tempOrderFilter.name == order.name" [value]="order.value">{{order.name}}</button>
        </mat-menu>
        <span *ngIf="(selectedTab == 'elements' || selectedTab == 'l-templates' || selectedTab == 'l-headers' || selectedTab == 'l-footers') && !wftgl" [class.open]="toggle.open" [class.close]="toggle.close" class="kb-search-field">
            <i [innerHTML]="_image.svg.search | safeHtml"></i>
            <input placeholder="Search here..." [(ngModel)]="searchText">
        </span>
        <button mat-button (click)="redirectToLink('/profile')">
            {{_general.user.name | titlecase}} <img
                [src]="_image.getImgPath(_image.uploadImgPath+_general.user.useravatar)"></button>
    </div>
</div>
<div *ngIf="selectedTab && !wftgl" class="kb-selection-container" [class.open]="toggle.open" [class.close]="toggle.close">
    <mat-icon mat-ripple (click)="prevSlide()" [class.kb-disabled]="slideShift <= 0" class="kb-side-arrow">keyboard_arrow_left</mat-icon>
    <div #selection class="kb-selection-option" [style.transform]="'translateX(-'+(_general.screenWidth - 100)*slideShift+'px)'" [ngSwitch]="selectedTab">
        <!-- layout -->
        <div *ngSwitchCase="'l-templates'" id="sectiongroup" class="kb-block-selection kb-template-list" cdkDropList [cdkDropListData]="_general.sectionTemplates" [cdkDropListConnectedTo]="_section.sectionConnect" cdkDropListSortingDisabled>
            <span cdkDrag *ngFor="let temp of _general.sectionTemplates | filter:searchText:'name' | sorting:tempOrderFilter.value:tempOrderFilter.type, index as i" (cdkDragMoved)="dragDataEmit(i)" [cdkDragData]="temp">
                <span>{{temp.name}}</span>
                <span mat-ripple class="kb-temp-trigger" #tempt="matMenuTrigger" [matMenuTriggerFor]="tempm" [class.kb-menu-active]="tempt.menuOpen">
                    <mat-icon>keyboard_arrow_down</mat-icon>
                </span>
                <mat-menu #tempm="matMenu" xPosition="before" yPosition="below">
                    <button mat-menu-item (click)="openDialog(renametempdialog, temp)"><i class="far fa-edit"></i> Rename</button>
                    <button mat-menu-item (click)="openDialog(deltempdialog, temp)"><i class="far fa-trash-alt"></i> Delete</button>
                </mat-menu>
                <div *cdkDragPreview class="custom-preview-img" [style.backgroundColor]="'var(--primary-color)'">
                    <img class="kb-images" [src]="_image.uploadImgPath+'keaimage-section-'+temp.uniqueid+'-screenshot.png'">
                </div>
                <span *cdkDragPlaceholder class="custom-placeholder" [style.backgroundColor]="'var(--section-color)'"></span>
            </span>
            <div *ngIf="_general.sectionTemplates.length == 0">Templates not found.</div>
        </div>
        <div *ngSwitchCase="'l-sections'" id="sectiongroup" class="kb-block-selection kb-section-list" cdkDropList [cdkDropListData]="_section.sectionTypes" [cdkDropListConnectedTo]="_section.sectionConnect" cdkDropListSortingDisabled>
            <span cdkDrag *ngFor="let st of _section.sectionTypes, index as i" (cdkDragMoved)="dragDataEmit(i)" [cdkDragData]="st">
                <span class="block"><span [style.width]="st.width">{{st.width}}</span></span>
                <span *cdkDragPreview class="custom-preview" [style.backgroundColor]="'var(--section-color)'">
                    {{st.width | titlecase}}
                </span>
                <span *cdkDragPlaceholder class="custom-placeholder" [style.backgroundColor]="'var(--section-color)'"></span>
            </span>
        </div>
        <div *ngSwitchCase="'l-rows'" id="rowgroup" class="kb-block-selection kb-row-list" cdkDropList [cdkDropListData]="_row.rowTypes" [cdkDropListConnectedTo]="_row.rowConnect" cdkDropListSortingDisabled>
            <span cdkDrag *ngFor="let rt of _row.rowTypes | filter:searchRowFilter.value:'row', index as i" (cdkDragMoved)="dragDataEmit(i)" [cdkDragData]="rt" class="kb-row-type"
                [class]="'row-'+rt.cls">
                    <span *ngFor="let c of rt.nofcolumn" class="block">
                        <span></span>
                    </span>
                    <span *cdkDragPreview class="custom-preview" [style.backgroundColor]="'var(--row-color)'">
                        Row
                    </span>
                    <span *cdkDragPlaceholder class="custom-placeholder" [style.backgroundColor]="'var(--row-color)'"></span>
            </span>
        </div>
        <div *ngSwitchCase="'l-headers'" class="kb-block-selection kb-block-list">
            <button mat-button (click)="redirectToLink('/website/headers')">
                <i [innerHTML]="_image.svg.add | safeHtml"></i> Add
            </button>
            <button mat-button *ngFor="let head of _general.headers | filter:searchText:'name'; index as i" 
            (click)="setHeader(head)" [class.kb-btn-active]="head.id == _general.selectedHeader.id && _general.includeLayout.header"
            (mouseover)="prevImg=head.thumbnail" (mouseout)="prevImg=''">
                {{head.name}}
            </button>
            <button mat-button (click)="setHeader(false)" [class.kb-btn-active]="!_general.includeLayout.header">
                <i [innerHTML]="_image.svg.none | safeHtml"></i> None
            </button>
        </div>
        <div *ngSwitchCase="'l-footers'" class="kb-block-selection kb-block-list">
            <button mat-button (click)="redirectToLink('/website/headers')">
                <i [innerHTML]="_image.svg.add | safeHtml"></i> Add
            </button>
            <button mat-button *ngFor="let foot of _general.footers | filter:searchText:'name'; index as i" 
            (click)="setFooter(foot)" [class.kb-btn-active]="foot.id == _general.selectedFooter.id && _general.includeLayout.footer"
            (mouseover)="prevImg=foot.thumbnail" (mouseout)="prevImg=''">
                {{foot.name}}
            </button>
            <button mat-button (click)="setFooter(false)" [class.kb-btn-active]="!_general.includeLayout.footer">
                <i [innerHTML]="_image.svg.none | safeHtml"></i> None
            </button>
        </div>
        <!-- layout -->
        <div *ngSwitchCase="'elements'">
            <button mat-button (click)="selectElement(element.content.name)" class="kb-icon-btn" [class.kb-btn-active]="selectedElement == element.content.name" *ngFor="let element of _element.elementList | filter:searchText:'element'">
                <i [class]="element.iconCls"></i>
                <span>{{element.content.name | titlecase}}</span>
            </button>
        </div>
        <div *ngSwitchCase="'responsive'">
            <button mat-button class="kb-icon-btn" [class.kb-btn-active]="_general.respToggleDevice.name == 'desktop'"
                (click)="respToggle('desktop')">
                <i [innerHTML]="_image.svg.desktop | safeHtml"></i><span>Desktop</span></button>
            <button mat-button class="kb-icon-btn" [class.kb-btn-active]="_general.respToggleDevice.name == 'tablet-h'"
                (click)="respToggle('tablet-h')">
                <i class="rotate-90" [innerHTML]="_image.svg.tab | safeHtml"></i><span>Tablet H</span></button>
            <button mat-button class="kb-icon-btn" [class.kb-btn-active]="_general.respToggleDevice.name == 'tablet-v'"
                (click)="respToggle('tablet-v')">
                <i [innerHTML]="_image.svg.tab | safeHtml"></i><span>Tablet V</span></button>
            <button mat-button class="kb-icon-btn" [class.kb-btn-active]="_general.respToggleDevice.name == 'mobile'"
                (click)="respToggle('mobile')">
                <i [innerHTML]="_image.svg.mobile | safeHtml"></i><span>Mobile</span></button>
        </div>
    </div>
    <mat-icon mat-ripple (click)="nextSlide()" [class.kb-disabled]="slideShift > shiftLen-1" class="kb-side-arrow">keyboard_arrow_right</mat-icon>
</div>
<div *ngIf="selectedTab == 'elements' && selectedElement && !wftgl" class="kb-selection-container" [class.open]="toggleElement.open" [class.close]="toggleElement.close">
    <mat-icon mat-ripple (click)="prevElementSlide()" [class.kb-disabled]="slideElementShift <= 0" class="kb-side-arrow">keyboard_arrow_left</mat-icon>
    <div #element class="kb-selection-option" [style.transform]="'translateX(-'+(_general.screenWidth - 100)*slideElementShift+'px)'" [ngSwitch]="selectedElement">
        <div *ngSwitchCase="'heading'" id="elementgroup" class="kb-block-selection kb-element-list kb-font-list" cdkDropList [cdkDropListData]="_element.defaultHeadings" [cdkDropListConnectedTo]="_element.elementConnect" cdkDropListSortingDisabled>
            <span cdkDrag *ngFor="let heading of _element.defaultHeadings, index as i " (cdkDragMoved)="dragDataEmit(i)" [cdkDragData]="heading">
                <span>{{heading.content.type | titlecase}}</span>
                <span *cdkDragPreview class="custom-preview" [style.backgroundColor]="'var(--primary-color)'">
                    {{heading.content.type | titlecase}} heading
                </span>
                <span *cdkDragPlaceholder class="custom-placeholder"
                [style.backgroundColor]="'var(--primary-color)'"></span>
            </span>
        </div>
        <div *ngSwitchCase="'text'" id="elementgroup" class="kb-block-selection kb-element-list kb-font-list" cdkDropList [cdkDropListData]="_element.defaultTexts" [cdkDropListConnectedTo]="_element.elementConnect" cdkDropListSortingDisabled>
            <span cdkDrag *ngFor="let text of _element.defaultTexts, index as i " (cdkDragMoved)="dragDataEmit(i)" [cdkDragData]="text">
                <span>{{text.content.type | uppercase}}</span>
                <span *cdkDragPreview class="custom-preview" [style.backgroundColor]="'var(--primary-color)'">
                    {{text.content.type | uppercase}} text
                </span>
                <span *cdkDragPlaceholder class="custom-placeholder"
                [style.backgroundColor]="'var(--primary-color)'"></span>
            </span>
        </div>
        <div *ngSwitchCase="'image'" id="elementgroup" class="kb-block-selection kb-element-list kb-img-list" cdkDropList [cdkDropListData]="_image.galleryImg" [cdkDropListConnectedTo]="_element.elementConnect" cdkDropListSortingDisabled>
            <button mat-button (click)="openImgDialog()" class="kb-icon-btn">
                <i [innerHTML]="_image.svg.upload | safeHtml"></i>
                <span>Upload</span>
            </button>
            <span cdkDrag *ngFor="let img of _image.galleryImg | filter:searchText:'title' | sorting:_image.searchImgFilter.value:_image.searchImgFilter.type, index as i" (cdkDragMoved)="dragDataEmit(i)" [cdkDragData]="img">
                <img class="kb-images" [src]="img.ext_link ? img.path : _image.uploadImgPath+img.path">
                <div *cdkDragPreview class="custom-preview-img" [style.backgroundColor]="'var(--primary-color)'">
                    <img class="kb-images" [src]="img.ext_link ? img.path : _image.uploadImgPath+img.path">
                </div>
                <span *cdkDragPlaceholder class="custom-placeholder"
                [style.backgroundColor]="'var(--primary-color)'"></span>
            </span>
        </div>
        <div *ngSwitchCase="'button'" id="elementgroup" class="kb-block-selection kb-element-list kb-btn-list" cdkDropList [cdkDropListData]="_element.defaultButtons" [cdkDropListConnectedTo]="_element.elementConnect" cdkDropListSortingDisabled>
            <span cdkDrag *ngFor="let btn of _element.defaultButtons, index as i " (cdkDragMoved)="dragDataEmit(i)" [cdkDragData]="btn">
                <span class="kb-d-btn">
                    {{btn.content.btntype | titlecase}}
                    <span *ngIf="btn.content.subtext" class="kb-d-btn-st">[Extra Text]</span>
                </span>
                <span *cdkDragPreview class="custom-preview kb-d-btn" [style.backgroundColor]="'var(--primary-color)'">
                    {{btn.content.btntype | titlecase}}
                    <span *ngIf="btn.content.subtext" class="kb-d-btn-st">[Extra Text]</span>
                </span>
                <span *cdkDragPlaceholder class="custom-placeholder"
                [style.backgroundColor]="'var(--primary-color)'"></span>
            </span>
        </div>
        <div *ngSwitchCase="'menu'" id="elementgroup" class="kb-block-selection kb-element-list kb-btn-list" cdkDropList [cdkDropListData]="_general.menus" [cdkDropListConnectedTo]="_element.elementConnect" cdkDropListSortingDisabled>
            <button mat-button (click)="redirectToLink('/website/navigation')" class="kb-icon-btn">
                <i [innerHTML]="_image.svg.add | safeHtml"></i>
                <span>Add</span>
            </button>
            <span cdkDrag *ngFor="let menu of _general.menus | filter:searchText:'name', index as i " (cdkDragMoved)="dragDataEmit(i)" [cdkDragData]="element">
                <span>{{menu.name | titlecase}}</span>
                <span *cdkDragPreview class="custom-preview" [style.backgroundColor]="'var(--primary-color)'">
                    {{menu.name | titlecase}}
                </span>
                <span *cdkDragPlaceholder class="custom-placeholder"
                [style.backgroundColor]="'var(--primary-color)'"></span>
            </span>
        </div>
    </div>
    <mat-icon mat-ripple (click)="nextElementSlide()" [class.kb-disabled]="slideElementShift > shiftElementLen-1" class="kb-side-arrow">keyboard_arrow_right</mat-icon>
</div>
<div *ngIf="prevImg" class="kb-block-preview">
    <div class="kb-block-prev-img" [style.backgroundImage]="'url('+_image.uploadImgPath+prevImg+')'"></div>
</div>