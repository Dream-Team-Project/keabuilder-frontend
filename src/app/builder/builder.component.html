
<div id="page-container" (click)="_general.showInlineEditor && !_general.insideEditor ? _general.resetInlineEditor() : '';">
    <div *ngIf="_section.sections.length != 0" id="topBar" (click)="!_general.showNavAnim.toggle ? _general.showfloatnavtoggle() : ''">
        <div class="innerLinks">
            <button mat-button (click)="_general.redirectToWebsite()"><img [src]="_image.imgPath+'logo/kblogo-white.svg'"></button>
            <button  mat-button *ngFor="let nav of topBarLinks" [routerLink]="nav.link" [matTooltip]="nav.name" matTooltipPosition="below"><i [class]="'fa '+nav.icon"></i></button>
        </div>
        <div class="innerLinks">
            <button mat-button [class.resp-active]="!_general.showResp.toggle" (click)="_general.showResp.toggle =  false" matTooltip="Desktop" matTooltipPosition="below"><i class="fa fa-desktop"></i></button>
            <button mat-button [class.resp-active]="_general.showResp.toggle && _general.respToggleDevice.name == 'tablet-h'" (click)="_general.selRespDevice(0)" matTooltip="Tablet Horizontal" matTooltipPosition="below"><i class="fas fa-tablet-alt rotate-90"></i></button>
            <button mat-button [class.resp-active]="_general.showResp.toggle && _general.respToggleDevice.name == 'tablet-v'" (click)="_general.selRespDevice(1)" matTooltip="Tablet Vertical" matTooltipPosition="below"><i class="fas fa-tablet-alt"></i></button>
            <button mat-button [class.resp-active]="_general.showResp.toggle && _general.respToggleDevice.name == 'mobile'" (click)="_general.selRespDevice(2)" matTooltip="Mobile" matTooltipPosition="below"><i class="fas fa-mobile-alt"></i></button>
            <button mat-button matTooltip="Redo" matTooltipPosition="below" (click)="_section.redo()"><i class="fas fa-redo"></i></button>
            <button mat-button matTooltip="Undo" matTooltipPosition="below" (click)="_section.undo()"><i class="fas fa-undo"></i></button>
            <button mat-button [routerLink]="'/profile'"><span>{{_general.username}}</span><img [src]="_image.imgPath+'profile/avatar.png'"></button>
        </div>
    </div>
    <app-builder-setting [DialogToggle]="DialogParentToggle"></app-builder-setting>
    <div id="kb-block-container" [class.loading]="!_general.loading.success" (click)="!_general.showNavAnim.toggle ? _general.showfloatnavtoggle() : ''">
        <div #main id="kb-main-conteiner" [class.kb-resp-view]="_general.showResp.toggle && _general.respToggleDevice.name != 'tablet-h'" [class.kb-border]="_general.showResp.toggle" [style.width]="_general.showResp.toggle ? _general.respToggleDevice.width : ''">
            <div id="kb-main" 
            [ngStyle]="_general.selectedBlock.type == 'main' ? _style.currentStyling() : _style.getBlockStyle(_general.main.style)">
                <div name="section" class="kb-drag-container" [sortablejs]="_section.sections"
                    [sortablejsOptions]="builderSectionOptions">
                    <!-- sections start -->
                    <div *ngFor="let section of _section.sections, index as si"
                        (mouseenter)="section.setting = true; _row.selectedSectionRows = section.rowArr"
                        (mouseleave)="section.setting = false"
                        [ngClass]="_style.getHideCls(section.hide)"
                        [class.kb-block-none]="_general.selectedBlock.id == section.id && _general.selectedBlock.type == section.type ? _style.getDisplay(_style.hide) : _style.getDisplay(section.hide)"
                        [ngStyle]="_general.selectedBlock.id == section.id && _general.selectedBlock.type == section.type ? _style.currentStyling() : _style.getBlockStyle(section.style)"
                        [id]="section.id" class="kb-section kb-block-container"
                        [class.kb-block-disabled]="_general.showInlineEditor">
                        <!-- sections setting navigation start -->
                        <div class="kb-module-setting" *ngIf="section.setting && !_general.showInlineEditor">
                            <span *ngIf="_section.sections.length > 1" class="kb-handle-block kb-handle-section"><i class="fa fa-arrows-alt"></i></span>
                            <span
                                (click)="_general.blockSelection = ''; _general.selectedBlock = section; _style.blockSetting(section); openDialog($event)"
                                matTooltip="Section Setting" matTooltipPosition="above"><i class="far fa-edit"></i></span>
                            <span (click)="_section.duplicateSection(section,si)" matTooltip="Duplicate Section"
                                matTooltipPosition="above"><i class="far fa-copy"></i></span>
                            <span (click)="_section.deleteSection(si)" *ngIf="_section.sections.length != 1"
                                matTooltip="Delete Section" matTooltipPosition="above"><i class="far fa-trash-alt"></i></span>
                        </div>
                        <!-- sections setting navigation end -->
                        <!-- add new row option start -->
                        <span (click)="_general.blockSelection = 'row';  _row.selectedRow=''; openDialog($event)"
                            *ngIf="section.rowArr.length == 0" class="kb-ispan-add add-row" matTooltip="Add New Row"
                            matTooltipPosition="right"><i class="fa fa-plus"></i></span>
                        <!-- add new row option end -->
                        <!-- add new section option start -->
                        <span (click)="_section.addSection(si)" *ngIf="section.setting && !_general.showInlineEditor"
                            class="kb-ispan-add add-section bottom-add-btn" matTooltip="Add New Section"
                            matTooltipPosition="below"><i class="fa fa-plus"></i></span>
                        <!-- add new section option end -->
                        <div name="row" class="kb-drag-container" [sortablejs]="section.rowArr"
                            [sortablejsOptions]="builderRowOptions">
                            <!-- rows start -->
                            <div *ngFor="let row of section.rowArr, index as ri"
                                (mouseenter)="row.setting = true; _row.selectedRow = row;"
                                (mouseleave)="row.setting = false"
                                [ngClass]="_style.getHideCls(row.hide)"
                                [class.kb-block-none]="_general.selectedBlock.id == row.id && _general.selectedBlock.type == row.type ? _style.getDisplay(_style.hide) : _style.getDisplay(row.hide)"
                                [ngStyle]="_general.selectedBlock.id == row.id && _general.selectedBlock.type == row.type ? _style.currentStyling() : _style.getBlockStyle(row.style)"
                                [id]="row.id"
                                [class.kb-block-disabled]="_general.showInlineEditor"
                                class="kb-row kb-block-container">
                                <!-- rows setting navigation start -->
                                <div class="kb-module-setting" *ngIf="row.setting && !_general.showInlineEditor">
                                    <span *ngIf="_section.sections.length > 1 || section.rowArr.length > 1" class="kb-handle-block kb-handle-row"><i class="fa fa-arrows-alt"></i></span>
                                    <span *ngIf="row.columnSetting" (click)="_general.blockSelection = 'row'; openDialog($event)"
                                        matTooltip="Column Structure" matTooltipPosition="above"><i
                                            class="fa fa-columns"></i></span>
                                    <span
                                        (click)="_general.blockSelection = ''; _general.selectedBlock = row; _style.blockSetting(row); openDialog($event)"
                                        matTooltip="Row Setting" matTooltipPosition="above"><i class="far fa-edit"></i></span>
                                    <span (click)="_row.duplicateRow(section.rowArr, row, ri)" matTooltip="Duplicate Row"
                                        matTooltipPosition="above"><i class="far fa-copy"></i></span>
                                    <span (click)="_row.deleteRow(section.rowArr, ri)" matTooltip="Delete Row"
                                        matTooltipPosition="above"><i class="far fa-trash-alt"></i></span>
                                </div>
                                <!-- rows setting navigation end -->
                                <div name="column" class="kb-column-wrap" 
                                [ngClass]="{'kb-desk-flex-rev': row.columnRev.desktop, 'kb-tab-h-flex-rev': row.columnRev.tablet_h, 'kb-tab-v-flex-rev': row.columnRev.tablet_v, 'kb-mob-flex-rev': row.columnRev.mobile}"
                                [class.flexColumnRev]="_style.getColumnReverse(row.columnRev)"
                                [style.flexDirection]="_general.selectedBlock.id == row.id && _general.selectedBlock.type == row.type ? _style.getColumnReverse(_style.columnRev): _style.getColumnReverse(row.columnRev)"
                                [style.gap]="(_general.selectedBlock.id == row.id && _general.selectedBlock.type == row.type ? _style.getBlockParamValue(_style.columnGap) : _style.getBlockParamValue(row.columnGap)) + 'rem'">
                                    <!-- columns start -->
                                    <div *ngFor="let column of row.columnArr, index as ci"
                                        (mouseenter)="_element.selectedElements = column.elementArr"
                                        [ngStyle]="_general.selectedBlock.id == column.id && _general.selectedBlock.type == column.type ? _style.currentStyling() : _style.getBlockStyle(column.style)"
                                        [ngClass]="_style.getHideCls(column.hide)"
                                        [class.kb-block-none]="_general.selectedBlock.id == column.id && _general.selectedBlock.type == column.type ? _style.getDisplay(_style.hide) : _style.getDisplay(column.hide)"
                                        [class]="row.rowSize"
                                        [id]="column.id" class="kb-column kb-block-container">
                                        <div name="element" class="kb-drag-container" [sortablejs]="column.elementArr"
                                            [sortablejsOptions]="builderElementOptions"
                                            (change)="_element.selectedElements = column.elementArr">
                                            <!-- elements start -->
                                            <div *ngFor="let element of column.elementArr, index as ei"
                                                (dblclick)="elementDblClk(element, $event)"
                                                (mouseenter)="element.setting = true"
                                                (mouseleave)="element.setting = false"
                                                [id]="element.id" class="kb-element kb-block-container"
                                                [ngClass]="_style.getHideCls(element.hide)"
                                                [class.kb-block-none]="_general.selectedBlock.id == element.id && _general.selectedBlock.type == element.type ? _style.getDisplay(_style.hide) : _style.getDisplay(element.hide)"
                                                [class.kb-block-disabled]="_general.showInlineEditor"
                                                [style.margin]="_general.selectedBlock.id == element.id && _general.selectedBlock.type == element.type ? _style.getMargin() : _style.getBlockStyle(element.style)['margin']"
                                                [style.justifyContent]="_general.selectedBlock.id == element.id && _general.selectedBlock.type == element.type ? _style.getBlockParamValue(_style.item_alignment) : _style.getBlockParamValue(element.item_alignment)">
                                                <div class="kb-module-setting" *ngIf="element.setting && !_general.showInlineEditor">
                                                    <span class="kb-handle-block kb-handle-element"><i class="fa fa-arrows-alt"></i></span>
                                                    <span
                                                        (click)="_general.blockSelection = ''; _general.selectedBlock = element; _style.blockSetting(element); openDialog($event)"
                                                        matTooltip="Element Setting" matTooltipPosition="above"><i
                                                            class="far fa-edit"></i></span>
                                                    <span
                                                        (click)="_column.selectedColumn = column; _element.duplicateElement(element, ei)"
                                                        matTooltip="Duplicate Element" matTooltipPosition="above"><i
                                                            class="far fa-copy"></i></span>
                                                    <span (click)="_element.deleteElement(column.elementArr, ei)"
                                                        matTooltip="Delete Element" matTooltipPosition="above"><i
                                                            class="far fa-trash-alt"></i></span>
                                                </div>
                                                <div [ngSwitch]="element.content.name">
                                                    <div *ngSwitchCase="'image'" class="kb-element-content">
                                                        <img *ngIf="_general.selectedBlock.id == element.id && _general.selectedBlock.type == element.type else showImg"
                                                            [ngStyle]="_style.imageStyling()"
                                                            [src]="_style.image_src ? _style.image_src : _image.imgPath+'builder/no-image.png'"
                                                            alt="image" width="auto" [class.dummyImg]="!_style.image_src">
                                                        <ng-template #showImg>
                                                            <img [ngStyle]="_style.getElementBlockStyle(element)"
                                                            [src]="element.content.src ? element.content.src : _image.imgPath+'builder/no-image.png'"
                                                            alt="image" width="auto" [class.dummyImg]="!element.content.src">
                                                        </ng-template>
                                                    </div>
                                                    <div *ngSwitchCase="'button'" class="kb-element-content">
                                                        <a *ngIf="_general.selectedBlock.id == element.id && _general.selectedBlock.type == element.type else showBtn" class="kb-default-btn" [href]="_style.button_link" [target]="_style.button_target" [ngStyle]="_style.buttonStyling()">
                                                            <div>{{_style.button_text}}</div>
                                                            <div class="subtext" [style.fontSize]="_style.button_subfont_size.value">{{_style.button_subtext}}</div>
                                                        </a>
                                                        <ng-template #showBtn><a class="kb-default-btn" [href]="element.content.link" [target]="element.content.target" [ngStyle]="_style.getElementBlockStyle(element)">
                                                            <div>{{element.content.text}}</div>
                                                            <div class="subtext" [style.fontSize]="element.content.subfont_size">{{element.content.subtext}}</div>
                                                        </a></ng-template>
                                                    </div>
                                                    <div *ngSwitchCase="'menu'" class="kb-element-content">
                                                        <ul class="kb-menu"
                                                        [ngStyle]="_general.selectedBlock.id == element.id && _general.selectedBlock.type == element.type ? _style.textStyling() : _style.getElementBlockStyle(element)">
                                                            <li *ngFor="let item of element.content.items, index as mi" [ngClass]="_style.getHideCls(item.hide)" [class.kb-block-none]="_style.getDisplay(item.hide)">
                                                                <a [id]="item.id" [href]="item.link">{{item.name}}</a>
                                                                <ul *ngIf="item.dropdown.length != 0" class="kb-sub-menu">
                                                                    <li *ngFor="let dp of item.dropdown, index as dpi" [ngClass]="_style.getHideCls(dp.hide)" [class.kb-block-none]="_style.getDisplay(dp.hide)">
                                                                        <a [id]="dp.id" [href]="dp.link">{{dp.name}}</a>
                                                                    </li>
                                                                </ul>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <div *ngSwitchDefault class="kb-element-content">
                                                        <div *ngIf="element.content.editor else text">
                                                            <tinymce [ngStyle]="_style.getBlockStyle(element.content.style)" [inline]="true" (mouseenter)="_general.insideEditor = true" (mouseleave)="_general.insideEditor = false;" [(ngModel)]="element.content.html"
                                                                [config]="_general.config"></tinymce>
                                                        </div>
                                                        <ng-template #text>
                                                            <div *ngIf="_general.selectedBlock.id == element.id && _general.selectedBlock.type == element.type else originalText"
                                                                [ngStyle]="_style.textStyling()"
                                                                [innerHTML]="_style.edit_html | safeHtml"></div>
                                                            <ng-template #originalText>
                                                                <div
                                                                [ngStyle]="_style.getElementBlockStyle(element)"
                                                                [innerHTML]="element.content.html | safeHtml"></div>
                                                            </ng-template>
                                                        </ng-template>
                                                    </div>
                                                </div>
                                                <span
                                                    (click)="_column.selectedColumn = column; _element.element_index = ei; _general.blockSelection = 'element'; openDialog($event)"
                                                    *ngIf="element.setting && !_general.showInlineEditor" matTooltip="Add New Element" matTooltipPosition="above"
                                                    class="kb-ispan-add add-element bottom-add-btn"><i
                                                        class="fa fa-plus"></i></span>
                                                <span *ngIf="_style.getDisplay(element.hide)" class="kb-block-hidden-icon"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>
                                            </div>
                                            <!-- elements end -->
                                        </div>
                                        <!-- add new column option start -->
                                        <span
                                            (click)="_column.selectedColumn = column; _element.element_index = 0; _general.blockSelection = 'element'; openDialog($event)"
                                            *ngIf="column.elementArr.length == 0" matTooltip="Add New Element"
                                            matTooltipPosition="right" class="kb-ispan-add add-element"><i
                                                class="fa fa-plus"></i></span>
                                        <!-- add new column option end -->
                                        <span *ngIf="_style.getDisplay(column.hide)" class="kb-block-hidden-icon"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>
                                    </div>
                                    <!-- columns end -->
                                </div>
                                <!-- add new row option start -->
                                <span *ngIf="row.setting && !_general.showInlineEditor"
                                    (click)="_row.selectedRow = ''; _row.row_index = ri; _general.blockSelection = 'row'; openDialog($event)"
                                    matTooltip="Add New Row" matTooltipPosition="below"
                                    class="kb-ispan-add add-row bottom-add-btn"><i class="fa fa-plus"></i></span>
                                <!-- add new row option end -->
                                <span *ngIf="_style.getDisplay(row.hide)" class="kb-block-hidden-icon"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>
                            </div>
                            <!-- rows end -->
                        </div>
                        <span *ngIf="_style.getDisplay(section.hide)" class="kb-block-hidden-icon"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>
                    </div>
                    <!-- sections end -->
                </div>
            </div>
        </div>
        <app-bulder-wireframe *ngIf="_general.wireframe.toggle"></app-bulder-wireframe>
    </div>
    <div id="kb-responsive-option" *ngIf="_general.showResp.toggle" [class.show-btn]="_general.showResp.open" [class.hide-btn]="_general.showResp.close">
        <button mat-button [class.resp-active]="_general.respToggleDevice.name == 'tablet-h'" (click)="_general.selRespDevice(0)" matTooltip="Tablet Horizontal" matTooltipPosition="right" class="nav-floating-btn"><i class="fas fa-tablet-alt rotate-90"></i></button>
        <button mat-button [class.resp-active]="_general.respToggleDevice.name == 'tablet-v'" (click)="_general.selRespDevice(1)" matTooltip="Tablet Vertical" matTooltipPosition="right" class="nav-floating-btn"><i class="fas fa-tablet-alt"></i></button>
        <button mat-button [class.resp-active]="_general.respToggleDevice.name == 'mobile'" (click)="_general.selRespDevice(2)" matTooltip="Mobile" matTooltipPosition="right" class="nav-floating-btn"><i class="fas fa-mobile-alt"></i></button>
        <button mat-button (click)="_general.responsiveToggle(false)" [disabled]="_general.showResp.open || _general.showResp.close" class="nav-floating-btn-host">
                <div id="navtimes" [class.navtimes-btn-open]="_general.showResp.open" [class.navtimes-btn-close]="_general.showResp.close">
                    <div class="navtimes">
                    <div class="navtime"></div>
                    </div>
                </div>
        </button>
    </div>
    <div id="kb-undo-redo-option" [style.right]="_general.wireframe.toggle ? 'calc('+_general.wfmW+' + '+'2%)' : ''" *ngIf="_general.undoRedo.toggle" [class.show-btn]="_general.undoRedo.open" [class.hide-btn]="_general.undoRedo.close">
        <button mat-button matTooltip="Redo" matTooltipPosition="left" (click)="_section.redo()" class="nav-floating-btn"><i class="fas fa-redo"></i></button>
        <button mat-button matTooltip="Undo" matTooltipPosition="left" (click)="_section.undo()" class="nav-floating-btn"><i class="fas fa-undo"></i></button>
        <button mat-button (click)="_general.undoRedoToggle(false)" [disabled]="_general.undoRedo.open || _general.undoRedo.close" class="nav-floating-btn-host">
                <div id="navtimes" [class.navtimes-btn-open]="_general.undoRedo.open" [class.navtimes-btn-close]="_general.undoRedo.close">
                    <div class="navtimes">
                    <div class="navtime"></div>
                    </div>
                </div>
        </button>
    </div>
    <div *ngIf="_general.loading.success else loading" id="kb-builder-nav" cdkDrag cdkDragBoundary="#page-container" (cdkDragEnded)="onDragEnded($event)">
        <span [ngClass]="'show-nav-animfrom-'+showNavFrom" [class.show-nav-anim]="_general.showNavAnim.open" [class.hide-nav-anim]="_general.showNavAnim.close" class="nav-floating-btn-group" *ngIf="_general.showNavAnim.show">
            <button mat-button (click)="openPageSetting($event)" matTooltip="Page Setting" matTooltipPosition="above" class="nav-floating-btn"><i class="fas fa-cogs"></i></button>
            <button mat-button (click)="_general.responsiveToggle(true)" matTooltip="Responsive Mode" matTooltipPosition="above" class="nav-floating-btn"><i class="fas fa-mobile-alt"></i></button>
            <button mat-button [disabled]="_general.saveDisabled" (click)="takePageSS(main);" matTooltip="Save" matTooltipPosition="above" class="nav-floating-btn"><i class="fas fa-save"></i></button>
            <button mat-button (click)="_general.undoRedoToggle(true)" matTooltip="Undo/Redo" matTooltipPosition="above" class="nav-floating-btn"><i class="fas fa-sync"></i></button>
            <button mat-button (click)="_general.wireframeToggle(true)" matTooltip="Wireframe" matTooltipPosition="above" class="nav-floating-btn"><i class="fas fa-network-wired"></i></button>
        </span>
        <button mat-button cdkDragHandle (click)="_general.showfloatnavtoggle()" [disabled]="_general.showNavAnim.open || _general.showNavAnim.close" class="nav-floating-btn-host">
            <div *ngIf="!_general.showNavAnim.navopen else navtimes" class="navdots">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ng-template #navtimes>
                <div id="navtimes" [class.navtimes-btn-open]="_general.showNavAnim.open" [class.navtimes-btn-close]="_general.showNavAnim.close">
                    <div class="navtimes">
                    <div class="navtime"></div>
                    </div>
                </div>
            </ng-template>
        </button>
    </div>
    <ng-template #loading>
        <div id="loader">
            <div id="shadow"></div>
            <div id="box"></div>
            <div *ngIf="_general.loading.error" class="loadErrMsg">Something went wrong!</div>
        </div>
    </ng-template>
    <div *ngIf="_general.saveDisabled" id="kb-save-loader">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
</div>
